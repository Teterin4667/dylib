name: Ð¡Ð±Ð¾Ñ€ÐºÐ° dylib Ð´Ð»Ñ Ñ€Ð°ÑÑ‚ÑÐ³Ð° ÑÐºÑ€Ð°Ð½Ð° Ð² Ð¸Ð³Ñ€Ð°Ñ… (Ð±ÐµÐ· Ð´Ð¶ÐµÐ¹Ð»Ð±Ñ€ÐµÐ¹ÐºÐ°)

on:
  workflow_dispatch:
    inputs:
      stretch_method:
        description: 'ÐœÐµÑ‚Ð¾Ð´ Ñ€Ð°ÑÑ‚ÑÐ³Ð°'
        required: true
        default: 'fov'
        type: choice
        options:
          - fov           # Ð£Ð²ÐµÐ»Ð¸Ñ‡ÐµÐ½Ð¸Ðµ Ð¿Ð¾Ð»Ñ Ð·Ñ€ÐµÐ½Ð¸Ñ
          - aspect        # Ð˜Ð·Ð¼ÐµÐ½ÐµÐ½Ð¸Ðµ ÑÐ¾Ð¾Ñ‚Ð½Ð¾ÑˆÐµÐ½Ð¸Ñ ÑÑ‚Ð¾Ñ€Ð¾Ð½
          - resolution    # Ð¤Ð¾Ñ€ÑÐ¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ðµ Ñ€Ð°Ð·Ñ€ÐµÑˆÐµÐ½Ð¸Ñ
          - metal_hack    # Metal API Ñ…Ð°Ðº
      stretch_value:
        description: 'Ð—Ð½Ð°Ñ‡ÐµÐ½Ð¸Ðµ Ñ€Ð°ÑÑ‚ÑÐ³Ð° (90-120 Ð´Ð»Ñ FOV, 1.0-2.0 Ð´Ð»Ñ aspect)'
        required: true
        default: '110'
      game_bundle:
        description: 'Bundle ID Ð¸Ð³Ñ€Ñ‹ (Ð½Ð°Ð¿Ñ€Ð¸Ð¼ÐµÑ€ com.tencent.tmgp.pubgm)'
        required: true
        default: 'com.tencent.tmgp.pubgm'
      ios_version:
        description: 'Ð¦ÐµÐ»ÐµÐ²Ð°Ñ iOS Ð²ÐµÑ€ÑÐ¸Ñ'
        required: true
        default: '14.0'

jobs:
  build-stretch-dylib:
    runs-on: macos-latest
    permissions:
      contents: write
    
    steps:
      - name: Ð§ÐµÐºÐ°ÑƒÑ‚
        uses: actions/checkout@v4
      
      - name: Ð£ÑÑ‚Ð°Ð½Ð¾Ð²ÐºÐ° iOS SDK Ð¸ Ð¸Ð½ÑÑ‚Ñ€ÑƒÐ¼ÐµÐ½Ñ‚Ð¾Ð²
        run: |
          # Ð£ÑÑ‚Ð°Ð½Ð°Ð²Ð»Ð¸Ð²Ð°ÐµÐ¼ iOS toolchain
          xcode-select --install || true
          
          # Ð£ÑÑ‚Ð°Ð½Ð°Ð²Ð»Ð¸Ð²Ð°ÐµÐ¼ iOS cross-compilation tools
          brew install \
            ios-deploy \
            ideviceinstaller \
            libimobiledevice \
            ldid \
            jq
          
          # Ð¡ÐºÐ°Ñ‡Ð¸Ð²Ð°ÐµÐ¼ Ð½ÐµÐ¾Ð±Ñ…Ð¾Ð´Ð¸Ð¼Ñ‹Ðµ Ð·Ð°Ð³Ð¾Ð»Ð¾Ð²ÐºÐ¸ iOS
          git clone https://github.com/nst/iOS-Runtime-Headers.git
          
          echo "ðŸ›  Ð˜Ð½ÑÑ‚Ñ€ÑƒÐ¼ÐµÐ½Ñ‚Ñ‹ ÑƒÑÑ‚Ð°Ð½Ð¾Ð²Ð»ÐµÐ½Ñ‹"
      
      - name: Ð¡Ð¾Ð·Ð´Ð°Ð½Ð¸Ðµ dylib Ñ Ñ€Ð°ÑÑ‚ÑÐ³Ð¾Ð¼
        run: |
          mkdir -p stretchlib
          
          # Ð¡Ð¾Ð·Ð´Ð°ÐµÐ¼ Ð¾ÑÐ½Ð¾Ð²Ð½Ð¾Ð¹ ÐºÐ¾Ð´ dylib
          cat > stretchlib/stretch.m << 'EOF'
          #import <Foundation/Foundation.h>
          #import <UIKit/UIKit.h>
          #import <objc/runtime.h>
          
          // ÐšÐ¾Ð½Ñ„Ð¸Ð³ÑƒÑ€Ð°Ñ†Ð¸Ñ Ñ€Ð°ÑÑ‚ÑÐ³Ð°
          #define STRETCH_METHOD ${{ github.event.inputs.stretch_method }}
          #define STRETCH_VALUE ${{ github.event.inputs.stretch_value }}
          #define GAME_BUNDLE @"${{ github.event.inputs.game_bundle }}"
          
          // Ð¥ÑƒÐºÐ¸ Ð´Ð»Ñ Metal (ÑÐ¾Ð²Ñ€ÐµÐ¼ÐµÐ½Ð½Ñ‹Ðµ Ð¸Ð³Ñ€Ñ‹)
          @interface MTLRenderPassDescriptor : NSObject
          - (void)setRenderTargetWidth:(NSUInteger)width;
          - (void)setRenderTargetHeight:(NSUInteger)height;
          @end
          
          // Ð¥ÑƒÐºÐ¸ Ð´Ð»Ñ OpenGL (ÑÑ‚Ð°Ñ€Ñ‹Ðµ Ð¸Ð³Ñ€Ñ‹)
          @interface EAGLContext : NSObject
          - (void)renderbufferStorage:(NSUInteger)target fromDrawable:(id)drawable;
          @end
          
          // ÐžÑÐ½Ð¾Ð²Ð½Ð¾Ð¹ ÐºÐ»Ð°ÑÑ Ñ€Ð°ÑÑ‚ÑÐ³Ð°
          @interface ScreenStretch : NSObject
          + (void)load;
          + (void)applyStretch;
          @end
          
          @implementation ScreenStretch
          
          + (void)load {
              // ÐŸÑ€Ð¾Ð²ÐµÑ€ÑÐµÐ¼ Ñ‡Ñ‚Ð¾ Ð¼Ñ‹ Ð² Ð½ÑƒÐ¶Ð½Ð¾Ð¹ Ð¸Ð³Ñ€Ðµ
              NSString *bundleID = [[NSBundle mainBundle] bundleIdentifier];
              if ([bundleID isEqualToString:GAME_BUNDLE]) {
                  NSLog(@"ðŸŽ® Ð Ð°ÑÑ‚ÑÐ³ Ð°ÐºÑ‚Ð¸Ð²Ð¸Ñ€Ð¾Ð²Ð°Ð½ Ð´Ð»Ñ %@", bundleID);
                  [self applyStretch];
                  
                  // ÐžÑ‚ÐºÐ»ÑŽÑ‡Ð°ÐµÐ¼ Ð·Ð°Ñ‰Ð¸Ñ‚Ñƒ Ð¾Ñ‚ Ñ‡Ð¸Ñ‚-Ð´Ð²Ð¸Ð¶ÐºÐ°
                  [[NSUserDefaults standardUserDefaults] setBool:NO forKey:@"antiCheatEnabled"];
              }
          }
          
          + (void)applyStretch {
              // ÐœÐµÑ‚Ð¾Ð´ 1: Ð Ð°ÑÑ‚ÑÐ³ Ñ‡ÐµÑ€ÐµÐ· FOV (ÐºÐ°Ð¼ÐµÑ€Ð°)
              if (STRETCH_METHOD == 1) { // fov
                  // Ð˜Ñ‰ÐµÐ¼ ÐºÐ°Ð¼ÐµÑ€Ñƒ Ð¸Ð³Ñ€Ñ‹ Ð¸ Ð¼ÐµÐ½ÑÐµÐ¼ FOV
                  Class cameraClass = NSClassFromString(@"GameCamera");
                  if (cameraClass) {
                      SEL fovSelector = NSSelectorFromString(@"setFieldOfView:");
                      if ([cameraClass respondsToSelector:fovSelector]) {
                          // Ð£Ð²ÐµÐ»Ð¸Ñ‡Ð¸Ð²Ð°ÐµÐ¼ FOV Ð´Ð»Ñ ÑÑ„Ñ„ÐµÐºÑ‚Ð° Ñ€Ð°ÑÑ‚ÑÐ³Ð°
                          [cameraClass performSelector:fovSelector withObject:@(STRETCH_VALUE)];
                      }
                  }
              }
              
              // ÐœÐµÑ‚Ð¾Ð´ 2: Ð˜Ð·Ð¼ÐµÐ½ÐµÐ½Ð¸Ðµ ÑÐ¾Ð¾Ñ‚Ð½Ð¾ÑˆÐµÐ½Ð¸Ñ ÑÑ‚Ð¾Ñ€Ð¾Ð½
              else if (STRETCH_METHOD == 2) { // aspect
                  UIScreen *mainScreen = [UIScreen mainScreen];
                  CGRect bounds = mainScreen.bounds;
                  
                  // Ð Ð°ÑÑ‚ÑÐ³Ð¸Ð²Ð°ÐµÐ¼ ÑÐ¾Ð¾Ñ‚Ð½Ð¾ÑˆÐµÐ½Ð¸Ðµ ÑÑ‚Ð¾Ñ€Ð¾Ð½
                  CGFloat newWidth = bounds.size.width * (STRETCH_VALUE / 100.0);
                  CGFloat newHeight = bounds.size.height;
                  
                  // Ð¤Ð¾Ñ€ÑÐ¸Ð¼ Ð½Ð¾Ð²Ð¾Ðµ Ñ€Ð°Ð·Ñ€ÐµÑˆÐµÐ½Ð¸Ðµ
                  NSValue *newBounds = [NSValue valueWithCGRect:CGRectMake(0, 0, newWidth, newHeight)];
                  [[NSNotificationCenter defaultCenter] postNotificationName:UIScreenModeDidChangeNotification 
                                                                    object:mainScreen 
                                                                  userInfo:@{@"bounds": newBounds}];
              }
              
              // ÐœÐµÑ‚Ð¾Ð´ 3: Metal Ñ…Ð°Ðº (Ð´Ð»Ñ ÑÐ¾Ð²Ñ€ÐµÐ¼ÐµÐ½Ð½Ñ‹Ñ… Ð¸Ð³Ñ€)
              else if (STRETCH_METHOD == 3) { // metal_hack
                  // ÐŸÐ¾Ð´Ð¼ÐµÐ½ÑÐµÐ¼ Metal view
                  Class metalViewClass = NSClassFromString(@"MTKView");
                  if (metalViewClass) {
                      Method originalMethod = class_getInstanceMethod(metalViewClass, @selector(draw));
                      Method swizzledMethod = class_getInstanceMethod(metalViewClass, @selector(stretched_draw));
                      method_exchangeImplementations(originalMethod, swizzledMethod);
                  }
              }
              
              // ÐŸÑ€Ð¸Ð¼ÐµÐ½ÑÐµÐ¼ Ñ€Ð°ÑÑ‚ÑÐ³ ÐºÐ¾ Ð²ÑÐµÐ¼ UI ÑÐ»ÐµÐ¼ÐµÐ½Ñ‚Ð°Ð¼
              [self stretchAllViews];
          }
          
          + (void)stretchAllViews {
              UIWindow *keyWindow = [UIApplication sharedApplication].keyWindow;
              if (keyWindow) {
                  // Ð Ð°ÑÑ‚ÑÐ³Ð¸Ð²Ð°ÐµÐ¼ ÐºÐ¾Ñ€Ð½ÐµÐ²Ð¾Ðµ view
                  keyWindow.rootViewController.view.transform = CGAffineTransformMakeScale(
                      STRETCH_VALUE / 100.0, 
                      STRETCH_VALUE / 100.0
                  );
                  
                  // Ð”Ð¾Ð±Ð°Ð²Ð»ÑÐµÐ¼ Ð¾Ð²ÐµÑ€Ð»ÐµÐ¹ Ð´Ð»Ñ Ð¸Ð½Ð´Ð¸ÐºÐ°Ñ†Ð¸Ð¸ Ñ€Ð°ÑÑ‚ÑÐ³Ð°
                  UILabel *stretchLabel = [[UILabel alloc] initWithFrame:CGRectMake(20, 50, 200, 30)];
                  stretchLabel.text = [NSString stringWithFormat:@"ðŸ”´ Ð ÐÐ¡Ð¢Ð¯Ð“ %d%%", STRETCH_VALUE];
                  stretchLabel.textColor = [UIColor redColor];
                  stretchLabel.font = [UIFont boldSystemFontOfSize:16];
                  stretchLabel.backgroundColor = [UIColor blackColor];
                  stretchLabel.alpha = 0.7;
                  stretchLabel.layer.cornerRadius = 10;
                  stretchLabel.clipsToBounds = YES;
                  stretchLabel.textAlignment = NSTextAlignmentCenter;
                  
                  [keyWindow addSubview:stretchLabel];
              }
          }
          
          @end
          
          // Metal swizzling
          @implementation MTKView (Stretch)
          
          - (void)stretched_draw {
              // ÐœÐµÐ½ÑÐµÐ¼ Ð²ÑŒÑŽÐ¿Ð¾Ñ€Ñ‚ Ð¿ÐµÑ€ÐµÐ´ Ñ€ÐµÐ½Ð´ÐµÑ€Ð¾Ð¼
              CGSize stretchSize = self.drawableSize;
              stretchSize.width *= (STRETCH_VALUE / 100.0);
              self.drawableSize = stretchSize;
              
              // Ð’Ñ‹Ð·Ñ‹Ð²Ð°ÐµÐ¼ Ð¾Ñ€Ð¸Ð³Ð¸Ð½Ð°Ð»ÑŒÐ½Ñ‹Ð¹ draw
              [self stretched_draw];
          }
          
          @end
          
          // Ð¢Ð¾Ñ‡ÐºÐ° Ð²Ñ…Ð¾Ð´Ð°
          __attribute__((constructor)) static void init() {
              NSLog(@"ðŸ“± dylib Ñ Ñ€Ð°ÑÑ‚ÑÐ³Ð¾Ð¼ Ð·Ð°Ð³Ñ€ÑƒÐ¶ÐµÐ½");
              [ScreenStretch load];
          }
          EOF
          
          # Ð¡Ð¾Ð·Ð´Ð°ÐµÐ¼ Ð·Ð°Ð³Ð¾Ð»Ð¾Ð²Ð¾Ñ‡Ð½Ñ‹Ð¹ Ñ„Ð°Ð¹Ð»
          cat > stretchlib/stretch.h << EOF
          #ifndef STRETCH_H
          #define STRETCH_H
          
          void apply_screen_stretch(float value);
          
          #endif
          EOF
      
      - name: ÐšÐ¾Ð¼Ð¿Ð¸Ð»ÑÑ†Ð¸Ñ dylib Ð´Ð»Ñ iOS
        run: |
          # ÐÐ°ÑÑ‚Ñ€Ð¾Ð¹ÐºÐ¸ ÐºÐ¾Ð¼Ð¿Ð¸Ð»ÑÑ†Ð¸Ð¸
          IOS_VERSION="${{ github.event.inputs.ios_version }}"
          ARCH="${{ github.event.inputs.arch || 'arm64' }}"
          
          # ÐŸÑƒÑ‚Ð¸ Ðº iOS SDK
          IOS_SDK=$(xcrun --sdk iphoneos --show-sdk-path)
          
          # ÐšÐ¾Ð¼Ð¿Ð¸Ð»Ð¸Ñ€ÑƒÐµÐ¼ Ð´Ð»Ñ ARM64 (iOS ÑƒÑÑ‚Ñ€Ð¾Ð¹ÑÑ‚Ð²Ð°)
          clang -arch arm64 \
                -isysroot $IOS_SDK \
                -mios-version-min=$IOS_VERSION \
                -fobjc-arc \
                -framework Foundation \
                -framework UIKit \
                -framework Metal \
                -dynamiclib \
                -install_name @executable_path/Frameworks/stretch.dylib \
                stretchlib/stretch.m \
                -o stretch.dylib
          
          # ÐŸÐ¾Ð´Ð¿Ð¸ÑÑ‹Ð²Ð°ÐµÐ¼ dylib (Ð¾Ð±ÑÐ·Ð°Ñ‚ÐµÐ»ÑŒÐ½Ð¾ Ð´Ð»Ñ iOS)
          ldid -S stretch.dylib
          
          # Ð¡Ð¾Ð·Ð´Ð°ÐµÐ¼ ÑƒÐ½Ð¸Ð²ÐµÑ€ÑÐ°Ð»ÑŒÐ½ÑƒÑŽ Ð±Ð¸Ð±Ð»Ð¸Ð¾Ñ‚ÐµÐºÑƒ ÐµÑÐ»Ð¸ Ð½ÑƒÐ¶Ð½Ð¾
          if [[ "${{ github.event.inputs.arch }}" == "all" ]]; then
            # ÐšÐ¾Ð¼Ð¿Ð¸Ð»Ð¸Ñ€ÑƒÐµÐ¼ Ð´Ð»Ñ ÑÐ¸Ð¼ÑƒÐ»ÑÑ‚Ð¾Ñ€Ð° (x86_64)
            SIM_SDK=$(xcrun --sdk iphonesimulator --show-sdk-path)
            clang -arch x86_64 \
                  -isysroot $SIM_SDK \
                  -mios-version-min=$IOS_VERSION \
                  -fobjc-arc \
                  -framework Foundation \
                  -framework UIKit \
                  -framework Metal \
                  -dynamiclib \
                  stretchlib/stretch.m \
                  -o stretch_x86.dylib
            
            # ÐžÐ±ÑŠÐµÐ´Ð¸Ð½ÑÐµÐ¼ Ð² fat binary
            lipo -create stretch.dylib stretch_x86.dylib -output stretch_universal.dylib
            mv stretch_universal.dylib stretch.dylib
          fi
          
          # Ð˜Ð½Ñ„Ð¾Ñ€Ð¼Ð°Ñ†Ð¸Ñ Ð¾ Ð±Ð¸Ð±Ð»Ð¸Ð¾Ñ‚ÐµÐºÐµ
          echo "âœ… dylib ÑÐºÐ¾Ð¼Ð¿Ð¸Ð»Ð¸Ñ€Ð¾Ð²Ð°Ð½:"
          file stretch.dylib
          lipo -info stretch.dylib || true
      
      - name: Ð¡Ð¾Ð·Ð´Ð°Ð½Ð¸Ðµ deb Ð¿Ð°ÐºÐµÑ‚Ð° (Ð´Ð»Ñ ÑƒÑÑ‚Ð°Ð½Ð¾Ð²ÐºÐ¸ Ñ‡ÐµÑ€ÐµÐ· Filza)
        run: |
          mkdir -p package/DEBIAN
          mkdir -p package/usr/lib
          mkdir -p package/Library/MobileSubstrate/DynamicLibraries
          
          # ÐšÐ¾Ð¿Ð¸Ñ€ÑƒÐµÐ¼ dylib
          cp stretch.dylib package/usr/lib/
          
          # Ð¡Ð¾Ð·Ð´Ð°ÐµÐ¼ plist Ð´Ð»Ñ MobileSubstrate
          cat > package/Library/MobileSubstrate/DynamicLibraries/stretch.plist << EOF
          {
            Filter = {
              Bundles = (
                "${{ github.event.inputs.game_bundle }}"
              );
            };
          }
          EOF
          
          # Ð¡Ð¾Ð·Ð´Ð°ÐµÐ¼ control Ñ„Ð°Ð¹Ð» Ð´Ð»Ñ deb
          cat > package/DEBIAN/control << EOF
          Package: com.stretch.gamer
          Name: Game Screen Stretch
          Version: 1.0-${{ github.run_number }}
          Architecture: iphoneos-arm
          Description: Ð Ð°ÑÑ‚ÑÐ³ ÑÐºÑ€Ð°Ð½Ð° Ð´Ð»Ñ Ð¸Ð³Ñ€ Ð±ÐµÐ· Ð´Ð¶ÐµÐ¹Ð»Ð±Ñ€ÐµÐ¹ÐºÐ°
          Author: GitHub Actions
          Maintainer: GitHub Actions
          Section: Tweaks
          Depends: mobilesubstrate (>= 0.9.5000)
          EOF
          
          # Ð¡Ð¾Ð·Ð´Ð°ÐµÐ¼ Ð¿Ð¾ÑÑ‚-Ð¸Ð½ÑÑ‚Ð°Ð»Ð» ÑÐºÑ€Ð¸Ð¿Ñ‚
          cat > package/DEBIAN/postinst << 'EOF'
          #!/bin/bash
          echo "ðŸ“± Ð Ð°ÑÑ‚ÑÐ³ ÑƒÑÑ‚Ð°Ð½Ð¾Ð²Ð»ÐµÐ½! ÐŸÐµÑ€ÐµÐ·Ð°Ð¿ÑƒÑÑ‚Ð¸Ñ‚Ðµ Ð¸Ð³Ñ€Ñƒ"
          killall -9 SpringBoard || true
          EOF
          chmod 755 package/DEBIAN/postinst
          
          # Ð¡Ð¾Ð±Ð¸Ñ€Ð°ÐµÐ¼ deb
          dpkg-deb -b package stretch-game.deb
      
      - name: Ð¡Ð¾Ð·Ð´Ð°Ð½Ð¸Ðµ IPA Ñ Ð²Ð½ÐµÐ´Ñ€ÐµÐ½Ð½Ñ‹Ð¼ dylib (Ð±ÐµÐ· Ð´Ð¶ÐµÐ¹Ð»Ð±Ñ€ÐµÐ¹ÐºÐ°)
        run: |
          mkdir -p injected_payload/Payload
          
          # Ð¡ÐºÐ°Ñ‡Ð¸Ð²Ð°ÐµÐ¼ Ð¿Ñ€Ð¸Ð¼ÐµÑ€ IPA Ð¸Ð»Ð¸ Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐµÐ¼ Ð·Ð°Ð³Ñ€ÑƒÐ¶ÐµÐ½Ð½Ñ‹Ð¹
          # Ð’ Ñ€ÐµÐ°Ð»ÑŒÐ½Ð¾ÑÑ‚Ð¸ Ñ‚ÑƒÑ‚ Ð½ÑƒÐ¶Ð½Ð¾ ÑÐºÐ°Ñ‡Ð°Ñ‚ÑŒ IPA Ð¸Ð³Ñ€Ñ‹
          
          # Ð¡Ð¾Ð·Ð´Ð°ÐµÐ¼ ÑÑ‚Ñ€ÑƒÐºÑ‚ÑƒÑ€Ñƒ Ð´Ð»Ñ Ð²Ð½ÐµÐ´Ñ€ÐµÐ½Ð¸Ñ
          mkdir -p injected_payload/Payload/Game.app/Frameworks
          
          # ÐšÐ¾Ð¿Ð¸Ñ€ÑƒÐµÐ¼ dylib Ð² Framework
          cp stretch.dylib injected_payload/Payload/Game.app/Frameworks/
          
          # Ð¡Ð¾Ð·Ð´Ð°ÐµÐ¼ ÑÐºÑ€Ð¸Ð¿Ñ‚ Ð´Ð»Ñ Ð²Ð½ÐµÐ´Ñ€ÐµÐ½Ð¸Ñ Ñ‡ÐµÑ€ÐµÐ· insert_dylib
          curl -LO https://github.com/Tyilo/insert_dylib/releases/download/1.0.0/insert_dylib
          chmod +x insert_dylib
          
          # Ð’ Ñ€ÐµÐ°Ð»ÑŒÐ½Ð¾ÑÑ‚Ð¸ Ñ‚ÑƒÑ‚ Ð½ÑƒÐ¶Ð½Ð¾ Ð¼Ð¾Ð´Ð¸Ñ„Ð¸Ñ†Ð¸Ñ€Ð¾Ð²Ð°Ñ‚ÑŒ Mach-O Ð±Ð¸Ð½Ð°Ñ€Ð½Ð¸Ðº Ð¸Ð³Ñ€Ñ‹
          # ./insert_dylib @executable_path/Frameworks/stretch.dylib Game Binary_stretched
          
          # Ð¡Ð¾Ð·Ð´Ð°ÐµÐ¼ README Ñ Ð¸Ð½ÑÑ‚Ñ€ÑƒÐºÑ†Ð¸ÐµÐ¹
          cat > README_INJECT.txt << EOF
          ðŸ”§ Ð˜ÐÐ¡Ð¢Ð Ð£ÐšÐ¦Ð˜Ð¯ ÐŸÐž Ð’ÐÐ•Ð”Ð Ð•ÐÐ˜Ð® Ð‘Ð•Ð— Ð”Ð–Ð•Ð™Ð›Ð‘Ð Ð•Ð™ÐšÐ:
          
          1. Ð¡Ð¿Ð¾ÑÐ¾Ð± 1 (Ñ Ð´Ð¶ÐµÐ¹Ð»Ð±Ñ€ÐµÐ¹ÐºÐ¾Ð¼):
             - Ð£ÑÑ‚Ð°Ð½Ð¾Ð²Ð¸ .deb Ñ‡ÐµÑ€ÐµÐ· Filza
             - ÐŸÐµÑ€ÐµÐ·Ð°Ð³Ñ€ÑƒÐ·Ð¸ ÑƒÑÑ‚Ñ€Ð¾Ð¹ÑÑ‚Ð²Ð¾
          
          2. Ð¡Ð¿Ð¾ÑÐ¾Ð± 2 (Ð±ÐµÐ· Ð´Ð¶ÐµÐ¹Ð»Ð±Ñ€ÐµÐ¹ÐºÐ°):
             - Ð£ÑÑ‚Ð°Ð½Ð¾Ð²Ð¸ TrollStore
             - ÐŸÐ¾Ð´Ð¿Ð¸ÑˆÐ¸ dylib Ñ‡ÐµÑ€ÐµÐ· TrollStore
             - Ð’Ð½ÐµÐ´Ñ€Ð¸ Ð² IPA Ñ‡ÐµÑ€ÐµÐ· Azule Ð¸Ð»Ð¸ ÑÐ°Ð¼Ð¾ÑÑ‚Ð¾ÑÑ‚ÐµÐ»ÑŒÐ½Ð¾
          
          3. Ð¡Ð¿Ð¾ÑÐ¾Ð± 3 (AltStore):
             - ÐŸÐµÑ€ÐµÐ¿Ð°ÐºÑƒÐ¹ IPA Ñ Ð²Ð½ÐµÐ´Ñ€ÐµÐ½Ð½Ñ‹Ð¼ dylib
             - ÐŸÐ¾Ð´Ð¿Ð¸ÑˆÐ¸ ÑÐ²Ð¾ÐµÐ¹ Ð¿Ð¾Ð´Ð¿Ð¸ÑÑŒÑŽ
             - Ð£ÑÑ‚Ð°Ð½Ð¾Ð²Ð¸ Ñ‡ÐµÑ€ÐµÐ· AltStore
          
          Ð¤Ð°Ð¹Ð»Ñ‹:
          - stretch.dylib - Ð¾ÑÐ½Ð¾Ð²Ð½Ð°Ñ Ð±Ð¸Ð±Ð»Ð¸Ð¾Ñ‚ÐµÐºÐ°
          - stretch-game.deb - Ð¿Ð°ÐºÐµÑ‚ Ð´Ð»Ñ Ð´Ð¶ÐµÐ¹Ð»Ð±Ñ€ÐµÐ¹ÐºÐ°
          - stretch.plist - ÐºÐ¾Ð½Ñ„Ð¸Ð³ Ð´Ð»Ñ MobileSubstrate
          
          ÐŸÐ°Ñ€Ð°Ð¼ÐµÑ‚Ñ€Ñ‹ Ñ€Ð°ÑÑ‚ÑÐ³Ð°:
          - ÐœÐµÑ‚Ð¾Ð´: ${{ github.event.inputs.stretch_method }}
          - Ð—Ð½Ð°Ñ‡ÐµÐ½Ð¸Ðµ: ${{ github.event.inputs.stretch_value }}
          - Ð˜Ð³Ñ€Ð°: ${{ github.event.inputs.game_bundle }}
          EOF
      
      - name: Ð¡Ð¾Ð·Ð´Ð°Ð½Ð¸Ðµ Ñ€ÐµÐ»Ð¸Ð·Ð°
        uses: softprops/action-gh-release@v1
        with:
          tag_name: stretch-v${{ github.run_number }}
          name: ðŸ“± Ð Ð°ÑÑ‚ÑÐ³ ÑÐºÑ€Ð°Ð½Ð° Ð´Ð»Ñ Ð¸Ð³Ñ€ v${{ github.run_number }}
          body: |
            ## ðŸŽ® Ð Ð°ÑÑ‚ÑÐ³ ÑÐºÑ€Ð°Ð½Ð° Ð´Ð»Ñ Ð¸Ð³Ñ€
            
            **ÐŸÐ°Ñ€Ð°Ð¼ÐµÑ‚Ñ€Ñ‹:**
            - ÐœÐµÑ‚Ð¾Ð´: ${{ github.event.inputs.stretch_method }}
            - Ð—Ð½Ð°Ñ‡ÐµÐ½Ð¸Ðµ: ${{ github.event.inputs.stretch_value }}
            - Ð˜Ð³Ñ€Ð°: ${{ github.event.inputs.game_bundle }}
            - iOS: ${{ github.event.inputs.ios_version }}
            
            **Ð¤Ð°Ð¹Ð»Ñ‹:**
            - `stretch.dylib` - Ð±Ð¸Ð±Ð»Ð¸Ð¾Ñ‚ÐµÐºÐ° Ñ€Ð°ÑÑ‚ÑÐ³Ð°
            - `stretch-game.deb` - Ð¿Ð°ÐºÐµÑ‚ Ð´Ð»Ñ Ð´Ð¶ÐµÐ¹Ð»Ð±Ñ€ÐµÐ¹ÐºÐ°
            - `stretch.plist` - ÐºÐ¾Ð½Ñ„Ð¸Ð³ÑƒÑ€Ð°Ñ†Ð¸Ñ
            
            **Ð£ÑÑ‚Ð°Ð½Ð¾Ð²ÐºÐ°:**
            1. **Ð¡ Ð´Ð¶ÐµÐ¹Ð»Ð±Ñ€ÐµÐ¹ÐºÐ¾Ð¼:** Ð£ÑÑ‚Ð°Ð½Ð¾Ð²Ð¸ .deb Ñ‡ÐµÑ€ÐµÐ· Filza/Sileo
            2. **Ð‘ÐµÐ· Ð´Ð¶ÐµÐ¹Ð»Ð±Ñ€ÐµÐ¹ÐºÐ°:** Ð˜ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐ¹ TrollStore Ð´Ð»Ñ Ð¿Ð¾Ð´Ð¿Ð¸ÑÐ¸ dylib
            3. **Ð’Ð½ÐµÐ´Ñ€ÐµÐ½Ð¸Ðµ Ð² IPA:** Ð˜ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐ¹ Azule Ð¸Ð»Ð¸ insert_dylib
            
            âš ï¸ Ð¢Ð¾Ð»ÑŒÐºÐ¾ Ð´Ð»Ñ Ð¾Ð±Ñ€Ð°Ð·Ð¾Ð²Ð°Ñ‚ÐµÐ»ÑŒÐ½Ñ‹Ñ… Ñ†ÐµÐ»ÐµÐ¹!
          files: |
            stretch.dylib
            stretch-game.deb
            package/Library/MobileSubstrate/DynamicLibraries/stretch.plist
            README_INJECT.txt
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
      
      - name: Ð—Ð°Ð³Ñ€ÑƒÐ·ÐºÐ° Ð°Ñ€Ñ‚ÐµÑ„Ð°ÐºÑ‚Ð¾Ð²
        uses: actions/upload-artifact@v4
        with:
          name: stretch-dylib-${{ github.run_number }}
          path: |
            stretch.dylib
            stretch-game.deb
            package/Library/MobileSubstrate/DynamicLibraries/stretch.plist
            README_INJECT.txt
          retention-days: 30
