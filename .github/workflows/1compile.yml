name: Build Game Menu Dylib

on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]
  workflow_dispatch:

jobs:
  build:
    runs-on: macos-latest
    
    steps:
    - uses: actions/checkout@v3
    
    - name: Install dependencies
      run: |
        brew update
        brew install llvm
        
    - name: Build Dylib
      run: |
        # ÐšÐ¾Ð¼Ð¿Ð¸Ð»ÑÑ†Ð¸Ñ Ð´Ð»Ñ macOS
        clang++ -std=c++11 -dynamiclib \
          -o game_menu.dylib \
          main.cpp \
          -Wall -O2 \
          -framework CoreFoundation \
          -framework IOKit \
          -arch x86_64 \
          -arch arm64 \
          -current_version 1.0 \
          -compatibility_version 1.0
        
        # Ð¡Ð¾Ð·Ð´Ð°Ð½Ð¸Ðµ ÑƒÐ½Ð¸Ð²ÐµÑ€ÑÐ°Ð»ÑŒÐ½Ð¾Ð³Ð¾ Ð±Ð¸Ð½Ð°Ñ€Ð½Ð¸ÐºÐ°
        lipo -info game_menu.dylib
        
    - name: Create Release Package
      run: |
        mkdir -p release
        cp game_menu.dylib release/
        
        # Ð¡Ð¾Ð·Ð´Ð°Ð½Ð¸Ðµ README
        cat > release/README.txt << EOF
        ðŸŽ® Ð˜Ð“Ð ÐžÐ’ÐžÐ• ÐœÐ•ÐÐ® Ð£Ð®Ð¢Ð ðŸŽ®
        
        Ð’ÐµÑ€ÑÐ¸Ñ: 1.0
        Ð”Ð°Ñ‚Ð° ÑÐ±Ð¾Ñ€ÐºÐ¸: $(date)
        
        Ð¤Ð£ÐÐšÐ¦Ð˜Ð˜:
        âœ… ÐÐ²Ñ‚Ð¾ÐºÐ»Ð¸ÐºÐµÑ€ Ñ Ð½Ð°ÑÑ‚Ñ€Ð°Ð¸Ð²Ð°ÐµÐ¼Ð¾Ð¹ Ð·Ð°Ð´ÐµÑ€Ð¶ÐºÐ¾Ð¹
        âœ… Ð Ð°Ð·Ð±Ð»Ð¾ÐºÐ¸Ñ€Ð¾Ð²ÐºÐ° FPS
        âœ… ÐšÐ°Ñ€Ñ‚Ð¾Ñ„ÐµÐ»ÑŒÐ½Ð°Ñ Ð³Ñ€Ð°Ñ„Ð¸ÐºÐ° Ð´Ð»Ñ ÑÐ»Ð°Ð±Ñ‹Ñ… ÐŸÐš
        âœ… Ð¡Ñ‡ÐµÑ‚Ñ‡Ð¸Ðº FPS Ð² Ñ€ÐµÐ°Ð»ÑŒÐ½Ð¾Ð¼ Ð²Ñ€ÐµÐ¼ÐµÐ½Ð¸
        âœ… Ð£ÑÐ¸Ð»ÐµÐ½Ð¸Ðµ ÑÑ€ÐºÐ¾ÑÑ‚Ð¸ ÑÐºÑ€Ð°Ð½Ð°
        âœ… Ð ÐµÐ¶Ð¸Ð¼ Ð´Ð»Ñ Ð´Ð°Ð»ÑŒÑ‚Ð¾Ð½Ð¸ÐºÐ¾Ð²
        âœ… ÐšÐ°ÑÑ‚Ð¾Ð¼Ð½Ñ‹Ð¹ Ð¿Ñ€Ð¸Ñ†ÐµÐ»
        âœ… Ð—Ð²ÑƒÐºÐ¾Ð²Ð¾Ð¹ ÑÐºÐ²Ð°Ð»Ð°Ð¹Ð·ÐµÑ€
        âœ… ÐžÐ¿Ñ‚Ð¸Ð¼Ð¸Ð·Ð°Ñ†Ð¸Ñ ÑÐµÑ‚Ð¸ (ÑÐ½Ð¸Ð¶ÐµÐ½Ð¸Ðµ Ð¿Ð¸Ð½Ð³Ð°)
        âœ… Ð ÐµÐ¶Ð¸Ð¼ ÑÑ‚Ñ€Ð¸Ð¼ÐµÑ€Ð°
        âœ… Ð ÐµÐ¶Ð¸Ð¼ ÑÐºÑ€Ð¸Ð½ÑˆÐ¾Ñ‚Ð°
        âœ… Ð¡Ñ‚Ð°Ð±Ð¸Ð»Ð¸Ð·Ð°Ñ‚Ð¾Ñ€ FPS
        âœ… ÐœÐ°ÑÑˆÑ‚Ð°Ð±Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ðµ Ð¸Ð½Ñ‚ÐµÑ€Ñ„ÐµÐ¹ÑÐ°
        
        Ð£ÐŸÐ ÐÐ’Ð›Ð•ÐÐ˜Ð•:
        F1-F12 - Ð²ÐºÐ»ÑŽÑ‡ÐµÐ½Ð¸Ðµ/Ð²Ñ‹ÐºÐ»ÑŽÑ‡ÐµÐ½Ð¸Ðµ Ñ„ÑƒÐ½ÐºÑ†Ð¸Ð¹
        ESC - Ð²Ñ‹Ñ…Ð¾Ð´ Ð¸Ð· Ð¼ÐµÐ½ÑŽ
        
        Ð£Ð¡Ð¢ÐÐÐžÐ’ÐšÐ:
        Ð¡ÐºÐ¾Ð¿Ð¸Ñ€ÑƒÐ¹Ñ‚Ðµ game_menu.dylib Ð² Ð¿Ð°Ð¿ÐºÑƒ Ñ Ð¸Ð³Ñ€Ð¾Ð¹
        Ð—Ð°Ð³Ñ€ÑƒÐ·Ð¸Ñ‚Ðµ Ñ‡ÐµÑ€ÐµÐ· Ð¸Ð½Ð¶ÐµÐºÑ‚Ð¾Ñ€ Ð¸Ð»Ð¸ LD_PRELOAD
        
        Ð¡Ð’Ð¯Ð—Ð¬:
        ÐŸÐ¾ Ð²Ð¾Ð¿Ñ€Ð¾ÑÐ°Ð¼ Ð¸ Ð¿Ñ€ÐµÐ´Ð»Ð¾Ð¶ÐµÐ½Ð¸ÑÐ¼: @game_menu
        EOF
        
    - name: Upload Artifact
      uses: actions/upload-artifact@v3
      with:
        name: game-menu-dylib
        path: release/
        
    - name: Create Release
      if: startsWith(github.ref, 'refs/tags/')
      uses: softprops/action-gh-release@v1
      with:
        files: |
          release/game_menu.dylib
          release/README.txt
        generate_release_notes: true
