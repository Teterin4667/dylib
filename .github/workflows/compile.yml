name: Compile iOS dylib

on: [push]

jobs:
  build:
    runs-on: macos-latest
    
    steps:
    - uses: actions/checkout@v4
    
    - name: Create menu.m
      run: |
        cat > menu.m << 'EOF'
        #include <objc/runtime.h>
        #include <UIKit/UIKit.h>
        
        @interface FloatingMenu : UIView <UIScrollViewDelegate>
        @property (nonatomic, strong) UIButton *button;
        @property (nonatomic, strong) UILabel *label;
        @property (nonatomic, assign) CGPoint touchOffset;
        @property (nonatomic, strong) UIScrollView *scrollView;
        @property (nonatomic, strong) UIPageControl *pageControl;
        @property (nonatomic, strong) NSMutableArray *toggles;
        @property (nonatomic, strong) UILabel *statusLabel;
        @end
        
        @implementation FloatingMenu
        
        - (instancetype)initWithFrame:(CGRect)frame {
            self = [super initWithFrame:frame];
            if (self) {
                // Размер меню
                self.frame = CGRectMake(50, 100, 350, 280);
                self.backgroundColor = [UIColor colorWithRed:0.1 green:0.1 blue:0.15 alpha:0.95];
                self.layer.cornerRadius = 15;
                self.layer.borderWidth = 2;
                self.layer.borderColor = [UIColor colorWithRed:0.3 green:0.5 blue:1.0 alpha:1.0].CGColor;
                
                _toggles = [NSMutableArray array];
                
                // Заголовок
                UILabel *title = [[UILabel alloc] initWithFrame:CGRectMake(15, 10, 200, 30)];
                title.text = @"STANDOFF 2 PRIVATE CHEAT";
                title.textColor = [UIColor colorWithRed:0.3 green:0.7 blue:1.0 alpha:1.0];
                title.font = [UIFont boldSystemFontOfSize:16];
                [self addSubview:title];
                
                // Статус
                _statusLabel = [[UILabel alloc] initWithFrame:CGRectMake(15, 40, 250, 20)];
                _statusLabel.text = @"Status: Undetected";
                _statusLabel.textColor = [UIColor greenColor];
                _statusLabel.font = [UIFont systemFontOfSize:12];
                [self addSubview:_statusLabel];
                
                // Вкладки
                NSArray *tabs = @[@"AIMBOT", @"VISUALS", @"MISC", @"SKINS", @"SETTINGS"];
                CGFloat tabWidth = 350 / tabs.count;
                for (int i = 0; i < tabs.count; i++) {
                    UIButton *tabBtn = [UIButton buttonWithType:UIButtonTypeSystem];
                    tabBtn.frame = CGRectMake(i * tabWidth, 65, tabWidth, 30);
                    [tabBtn setTitle:tabs[i] forState:UIControlStateNormal];
                    [tabBtn setTitleColor:[UIColor whiteColor] forState:UIControlStateNormal];
                    tabBtn.titleLabel.font = [UIFont boldSystemFontOfSize:11];
                    tabBtn.backgroundColor = i == 0 ? [UIColor colorWithRed:0.3 green:0.5 blue:1.0 alpha:0.8] : [UIColor colorWithWhite:0.2 alpha:0.8];
                    tabBtn.tag = i;
                    [tabBtn addTarget:self action:@selector(tabClicked:) forControlEvents:UIControlEventTouchUpInside];
                    [self addSubview:tabBtn];
                }
                
                // ScrollView для функций (перелистывание)
                _scrollView = [[UIScrollView alloc] initWithFrame:CGRectMake(10, 100, 330, 140)];
                _scrollView.pagingEnabled = YES;
                _scrollView.showsHorizontalScrollIndicator = NO;
                _scrollView.delegate = self;
                _scrollView.contentSize = CGSizeMake(330 * 3, 140);
                _scrollView.backgroundColor = [UIColor clearColor];
                [self addSubview:_scrollView];
                
                // Страница 1 - Aimbot
                [self createPage1];
                
                // Страница 2 - Visuals
                [self createPage2];
                
                // Страница 3 - Misc
                [self createPage3];
                
                // PageControl
                _pageControl = [[UIPageControl alloc] initWithFrame:CGRectMake(120, 240, 100, 20)];
                _pageControl.numberOfPages = 3;
                _pageControl.currentPage = 0;
                _pageControl.pageIndicatorTintColor = [UIColor grayColor];
                _pageControl.currentPageIndicatorTintColor = [UIColor whiteColor];
                [_pageControl addTarget:self action:@selector(pageChanged:) forControlEvents:UIControlEventValueChanged];
                [self addSubview:_pageControl];
                
                // Кнопки управления
                UIButton *applyBtn = [UIButton buttonWithType:UIButtonTypeSystem];
                applyBtn.frame = CGRectMake(180, 245, 70, 25);
                [applyBtn setTitle:@"APPLY" forState:UIControlStateNormal];
                [applyBtn setTitleColor:[UIColor whiteColor] forState:UIControlStateNormal];
                applyBtn.backgroundColor = [UIColor colorWithRed:0.2 green:0.6 blue:0.2 alpha:1.0];
                applyBtn.layer.cornerRadius = 5;
                [applyBtn addTarget:self action:@selector(applyClicked) forControlEvents:UIControlEventTouchUpInside];
                [self addSubview:applyBtn];
                
                UIButton *closeBtn = [UIButton buttonWithType:UIButtonTypeCustom];
                closeBtn.frame = CGRectMake(320, 10, 25, 25);
                [closeBtn setTitle:@"✕" forState:UIControlStateNormal];
                [closeBtn setTitleColor:[UIColor redColor] forState:UIControlStateNormal];
                closeBtn.titleLabel.font = [UIFont boldSystemFontOfSize:20];
                [closeBtn addTarget:self action:@selector(close) forControlEvents:UIControlEventTouchUpInside];
                [self addSubview:closeBtn];
                
                // Инфо
                UILabel *infoLabel = [[UILabel alloc] initWithFrame:CGRectMake(15, 245, 100, 20)];
                infoLabel.text = @"v2.0 | Private";
                infoLabel.textColor = [UIColor grayColor];
                infoLabel.font = [UIFont systemFontOfSize:10];
                [self addSubview:infoLabel];
            }
            return self;
        }
        
        - (void)createPage1 {
            UIView *page = [[UIView alloc] initWithFrame:CGRectMake(0, 0, 330, 140)];
            
            NSArray *items = @[
                @{@"name": @"Aimbot", @"type": @"toggle"},
                @{@"name": @"No Recoil", @"type": @"toggle"},
                @{@"name": @"No Spread", @"type": @"toggle"},
                @{@"name": @"Auto Shoot", @"type": @"toggle"},
                @{@"name": @"FOV Slider", @"type": @"slider", @"min": @30, @"max": @180, @"default": @60},
                @{@"name": @"Smooth Slider", @"type": @"slider", @"min": @1, @"max": @20, @"default": @5},
                @{@"name": @"Aim Bone", @"type": @"selector", @"options": @[@"Head", @"Chest", @"Legs"]}
            ];
            
            [self createItems:items onPage:page offsetY:5];
            [_scrollView addSubview:page];
        }
        
        - (void)createPage2 {
            UIView *page = [[UIView alloc] initWithFrame:CGRectMake(330, 0, 330, 140)];
            
            NSArray *items = @[
                @{@"name": @"ESP", @"type": @"toggle"},
                @{@"name": @"Wallhack", @"type": @"toggle"},
                @{@"name": @"Radar", @"type": @"toggle"},
                @{@"name": @"Player Names", @"type": @"toggle"},
                @{@"name": @"Distance ESP", @"type": @"toggle"},
                @{@"name": @"ESP Distance", @"type": @"slider", @"min": @10, @"max": @500, @"default": @100},
                @{@"name": @"ESP Color", @"type": @"color"}
            ];
            
            [self createItems:items onPage:page offsetY:5];
            [_scrollView addSubview:page];
        }
        
        - (void)createPage3 {
            UIView *page = [[UIView alloc] initWithFrame:CGRectMake(660, 0, 330, 140)];
            
            NSArray *items = @[
                @{@"name": @"Speed Hack", @"type": @"toggle"},
                @{@"name": @"God Mode", @"type": @"toggle"},
                @{@"name": @"Unlimited Ammo", @"type": @"toggle"},
                @{@"name": @"No Reload", @"type": @"toggle"},
                @{@"name": @"Speed Multiplier", @"type": @"slider", @"min": @1, @"max": @5, @"default": @1.5},
                @{@"name": @"Jump Height", @"type": @"slider", @"min": @1, @"max": @3, @"default": @1.2},
                @{@"name": @"Gravity", @"type": @"selector", @"options": @[@"Normal", @"Low", @"Zero"]}
            ];
            
            [self createItems:items onPage:page offsetY:5];
            [_scrollView addSubview:page];
        }
        
        - (void)createItems:(NSArray *)items onPage:(UIView *)page offsetY:(CGFloat)offsetY {
            CGFloat y = offsetY;
            int col = 0;
            
            for (NSDictionary *item in items) {
                CGFloat x = col == 0 ? 10 : 170;
                
                UILabel *nameLabel = [[UILabel alloc] initWithFrame:CGRectMake(x, y, 150, 18)];
                nameLabel.text = item[@"name"];
                nameLabel.textColor = [UIColor whiteColor];
                nameLabel.font = [UIFont systemFontOfSize:11];
                [page addSubview:nameLabel];
                
                if ([item[@"type"] isEqualToString:@"toggle"]) {
                    UISwitch *sw = [[UISwitch alloc] initWithFrame:CGRectMake(x + 100, y-3, 40, 20)];
                    sw.onTintColor = [UIColor colorWithRed:0.3 green:0.7 blue:0.3 alpha:1.0];
                    sw.transform = CGAffineTransformMakeScale(0.6, 0.6);
                    sw.tag = 1000 + _toggles.count;
                    [page addSubview:sw];
                    [_toggles addObject:sw];
                }
                else if ([item[@"type"] isEqualToString:@"slider"]) {
                    UISlider *slider = [[UISlider alloc] initWithFrame:CGRectMake(x + 80, y, 80, 20)];
                    slider.minimumValue = [item[@"min"] floatValue];
                    slider.maximumValue = [item[@"max"] floatValue];
                    slider.value = [item[@"default"] floatValue];
                    slider.tag = 2000 + _toggles.count;
                    slider.transform = CGAffineTransformMakeScale(0.8, 0.8);
                    [page addSubview:slider];
                    
                    UILabel *valLabel = [[UILabel alloc] initWithFrame:CGRectMake(x + 140, y, 30, 15)];
                    valLabel.text = [NSString stringWithFormat:@"%.0f", slider.value];
                    valLabel.textColor = [UIColor yellowColor];
                    valLabel.font = [UIFont systemFontOfSize:9];
                    valLabel.tag = 3000 + _toggles.count;
                    [page addSubview:valLabel];
                    
                    [slider addTarget:self action:@selector(sliderChanged:) forControlEvents:UIControlEventValueChanged];
                }
                else if ([item[@"type"] isEqualToString:@"selector"]) {
                    UIButton *selBtn = [UIButton buttonWithType:UIButtonTypeSystem];
                    selBtn.frame = CGRectMake(x + 90, y-2, 60, 20);
                    [selBtn setTitle:item[@"options"][0] forState:UIControlStateNormal];
                    [selBtn setTitleColor:[UIColor blackColor] forState:UIControlStateNormal];
                    selBtn.backgroundColor = [UIColor whiteColor];
                    selBtn.titleLabel.font = [UIFont systemFontOfSize:9];
                    selBtn.layer.cornerRadius = 3;
                    selBtn.tag = 4000 + _toggles.count;
                    [selBtn addTarget:self action:@selector(selectorClicked:) forControlEvents:UIControlEventTouchUpInside];
                    [page addSubview:selBtn];
                }
                else if ([item[@"type"] isEqualToString:@"color"]) {
                    UIButton *colorBtn = [UIButton buttonWithType:UIButtonTypeCustom];
                    colorBtn.frame = CGRectMake(x + 130, y-2, 30, 18);
                    colorBtn.backgroundColor = [UIColor redColor];
                    colorBtn.layer.cornerRadius = 3;
                    colorBtn.tag = 5000 + _toggles.count;
                    [colorBtn addTarget:self action:@selector(colorClicked:) forControlEvents:UIControlEventTouchUpInside];
                    [page addSubview:colorBtn];
                }
                
                y += 22;
                if (y > 120) {
                    y = offsetY;
                    col = 1;
                }
            }
        }
        
        - (void)sliderChanged:(UISlider *)sender {
            UILabel *label = [self viewWithTag:sender.tag + 1000];
            label.text = [NSString stringWithFormat:@"%.0f", sender.value];
        }
        
        - (void)selectorClicked:(UIButton *)sender {
            NSArray *options = @[@"Head", @"Chest", @"Legs"]; // Заглушка
            NSString *current = sender.titleLabel.text;
            int idx = 0;
            for (int i = 0; i < options.count; i++) {
                if ([options[i] isEqualToString:current]) {
                    idx = (i + 1) % options.count;
                    break;
                }
            }
            [sender setTitle:options[idx] forState:UIControlStateNormal];
        }
        
        - (void)colorClicked:(UIButton *)sender {
            static int colorIdx = 0;
            NSArray *colors = @[
                [UIColor redColor],
                [UIColor greenColor],
                [UIColor blueColor],
                [UIColor yellowColor],
                [UIColor purpleColor]
            ];
            colorIdx = (colorIdx + 1) % colors.count;
            sender.backgroundColor = colors[colorIdx];
        }
        
        - (void)applyClicked {
            self.statusLabel.text = @"Status: Applied!";
            self.statusLabel.textColor = [UIColor greenColor];
            
            dispatch_after(dispatch_time(DISPATCH_TIME_NOW, 2 * NSEC_PER_SEC), dispatch_get_main_queue(), ^{
                self.statusLabel.text = @"Status: Undetected";
            });
        }
        
        - (void)tabClicked:(UIButton *)sender {
            // Подсветка вкладок
            for (UIView *view in self.subviews) {
                if ([view isKindOfClass:[UIButton class]] && view.frame.size.height == 30 && view.frame.origin.y == 65) {
                    if (view.tag == sender.tag) {
                        view.backgroundColor = [UIColor colorWithRed:0.3 green:0.5 blue:1.0 alpha:0.8];
                    } else {
                        view.backgroundColor = [UIColor colorWithWhite:0.2 alpha:0.8];
                    }
                }
            }
            
            // Переключение страниц
            if (sender.tag == 0) [_scrollView setContentOffset:CGPointMake(0, 0) animated:YES];
            else if (sender.tag == 1) [_scrollView setContentOffset:CGPointMake(330, 0) animated:YES];
            else if (sender.tag == 2) [_scrollView setContentOffset:CGPointMake(660, 0) animated:YES];
        }
        
        - (void)scrollViewDidScroll:(UIScrollView *)scrollView {
            CGFloat pageWidth = scrollView.frame.size.width;
            int page = floor((scrollView.contentOffset.x - pageWidth/2) / pageWidth) + 1;
            _pageControl.currentPage = page;
        }
        
        - (void)pageChanged:(UIPageControl *)sender {
            [_scrollView setContentOffset:CGPointMake(sender.currentPage * 330, 0) animated:YES];
        }
        
        - (void)close {
            [self removeFromSuperview];
        }
        
        - (void)touchesBegan:(NSSet *)touches withEvent:(UIEvent *)event {
            UITouch *touch = [touches anyObject];
            CGPoint point = [touch locationInView:self.superview];
            self.touchOffset = CGPointMake(point.x - self.frame.origin.x, point.y - self.frame.origin.y);
        }
        
        - (void)touchesMoved:(NSSet *)touches withEvent:(UIEvent *)event {
            UITouch *touch = [touches anyObject];
            CGPoint point = [touch locationInView:self.superview];
            self.frame = CGRectMake(point.x - self.touchOffset.x, point.y - self.touchOffset.y, 
                                   self.frame.size.width, self.frame.size.height);
        }
        
        @end
        
        static void (*orig_viewDidAppear)(id, SEL, BOOL);
        
        static void hooked_viewDidAppear(id self, SEL _cmd, BOOL animated) {
            orig_viewDidAppear(self, _cmd, animated);
            
            dispatch_after(dispatch_time(DISPATCH_TIME_NOW, 1 * NSEC_PER_SEC), dispatch_get_main_queue(), ^{
                UIWindow *window = [UIApplication sharedApplication].keyWindow;
                
                BOOL exists = NO;
                for (UIView *v in window.subviews) {
                    if ([v isKindOfClass:[FloatingMenu class]]) {
                        exists = YES;
                        break;
                    }
                }
                
                if (!exists) {
                    FloatingMenu *menu = [[FloatingMenu alloc] init];
                    [window addSubview:menu];
                }
            });
        }
        
        __attribute__((constructor))
        static void init() {
            dispatch_async(dispatch_get_main_queue(), ^{
                Class class = [UIViewController class];
                Method original = class_getInstanceMethod(class, @selector(viewDidAppear:));
                orig_viewDidAppear = (void *)method_setImplementation(original, (IMP)hooked_viewDidAppear);
                NSLog(@"[✓] Standoff2 Cheat v2.0 Loaded");
            });
        }
        EOF
    
    - name: Compile with Xcode
      run: |
        xcrun -sdk iphoneos clang -arch arm64 -fobjc-arc -dynamiclib \
          -framework UIKit \
          -framework Foundation \
          -framework CoreGraphics \
          -isysroot $(xcrun -sdk iphoneos --show-sdk-path) \
          menu.m \
          -o standoff2_cheat.dylib
    
    - name: Upload dylib
      uses: actions/upload-artifact@v4
      with:
        name: standoff2_cheat.dylib
        path: standoff2_cheat.dylib
